<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.19" />
  <meta name="author" content="Yang Cao">
  <meta name="description" content="Assistant Professor">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="/css/highlight.min.css">
    
  
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  

  <link rel="alternate" href="http://www.choyang.me/index.xml" type="application/rss+xml" title="Yang">
  <link rel="feed" href="http://www.choyang.me/index.xml" type="application/rss+xml" title="Yang">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="http://www.choyang.me/post/2014-11-4-r-code-style/">

  

  <title>R code style | Yang</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Yang</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#publications">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  

  <div class="article-container">
    <h1 itemprop="name">R code style</h1>
    

<div class="article-metadata">

  <span class="article-date">
    <time datetime="2014-11-04 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Tue, Nov 4, 2014
    </time>
  </span>

  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="/tags/r">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fwww.choyang.me%2fpost%2f2014-11-4-r-code-style%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=R%20code%20style&amp;url=http%3a%2f%2fwww.choyang.me%2fpost%2f2014-11-4-r-code-style%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwww.choyang.me%2fpost%2f2014-11-4-r-code-style%2f&amp;title=R%20code%20style"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fwww.choyang.me%2fpost%2f2014-11-4-r-code-style%2f&amp;title=R%20code%20style"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=R%20code%20style&amp;body=http%3a%2f%2fwww.choyang.me%2fpost%2f2014-11-4-r-code-style%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      <p>R作为用于统计计算和图形可视化的高级语言，随着近来来大数据的发展，R语言逐渐成长为数据分析的利器，良好的代码风格使代码更容易阅读，
分享和扩展，下面基于Rstudio首席科学家<a href="http://had.co.nz/">hadley</a>和google的R团队的代码风格做了一些小的调整。</p>

<h3 id="符号和命名">符号和命名</h3>

<h4 id="文件名字">文件名字</h4>

<ul>
<li><em>.R</em> 作为文件扩展名</li>

<li><p>文件的命名要与它的功能相关</p>

<ul>
<li><p>GOOD: predict_ad_revenue.R</p></li>

<li><p>BAD: foo.R</p></li>
</ul></li>
</ul>

<!-- more -->

<h4 id="对象名称">对象名称</h4>

<p>标识符中不要含有<em>-</em> 和<em>_</em>, 变量名字使用小写, 词之间用<em>.</em> 分割(variable.name), varibaleName也可以, 个人偏向使用前一种; 函数名每个词第一个字母要大写 (FunctionName), 第一个词是动词, hadely目前是利用<em>_</em> ；因为R的方法调用都或者某些类的定义使用<em>.</em>,所以函数的定义不要使用<em>.</em>; 常量命名规则除了名字开头加个*k*其他与函数一致, (kConstantName)</p>

<ul>
<li><p>variable.name is preferred, variableName is accepted</p>

<ul>
<li><p>GOOD: avg.clicks</p></li>

<li><p>OK: avgClicks</p></li>

<li><p>BAD: avg_Clicks</p></li>
</ul></li>

<li><p>FunctionName</p>

<ul>
<li><p>GOOD: CalculateAvgClicks</p></li>

<li><p>BAD: calculate_avg_clicks , calculateAvgClicks</p></li>

<li><p>Make function names verbs.</p></li>
</ul></li>
</ul>

<p>例外: When creating a classed object, the function name (constructor) and class should match (e.g.,lm).</p>

<ul>
<li><p>常量：k加上常量名称，kConstantName</p>

<p>当然不能使用R中自定义的已存在的函数和变量的名字</p></li>
</ul>

<pre><code class="language-r"># Bad
T &lt;- FALSE
c &lt;- 10
mean &lt;- function(x) sum(x)
</code></pre>

<h3 id="句法">句法</h3>

<h4 id="每行代码的字符数">每行代码的字符数</h4>

<p>不超过80个字符；如果发现自己的代码行超过80个字符，那么要考虑封装代码至一个简短函数，或者使用<a href="http://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html" target="_blank">magrittr</a>包的管道操作符.</p>

<h4 id="缩进">缩进</h4>

<p>两个空格, 不要用tab tab与空格一起使用</p>

<p>例外: 换行在一个括号内, 那么下一行开头和括号内第一个字符对齐</p>

<pre><code class="language-r">long_function_name &lt;- function(a = &quot;a long argument&quot;, 
                               b = &quot;another argument&quot;,
                               c = &quot;another long argument&quot;) {
  # As usual code is indented by two spaces.
}
</code></pre>

<h4 id="空格">空格</h4>

<p>所有的二元操作符两边有一个空格(=, +, -, &lt;-, etc.).</p>

<p>函数调用传递参数时候=号两边的空格可有可无, 个人觉得应该有空格</p>

<p>逗号之前不要有空格, 后面要加空格</p>

<p><code>:</code>, <code>::</code> 和<code>:::</code> 两边不需要空格</p>

<p>GOOD:</p>

<pre><code class="language-r">tab.prior &lt;- table(df[df$days.from.opt &lt; 0, &quot;campaign.id&quot;])
total &lt;- sum(x[, 1])
total &lt;- sum(x[1, ])
</code></pre>

<p>BAD:</p>

<pre><code class="language-r">tab.prior &lt;- table(df[df$days.from.opt &lt; 0, &quot;campaign.id&quot;])  # Needs spaces around '&lt;'
tab.prior &lt;- table(df[df$days.from.opt &lt; 0, &quot;campaign.id&quot;])  # Needs a space after the comma
tab.prior &lt;- table(df[df$days.from.opt &lt; 0, &quot;campaign.id&quot;])  # Needs a space before &lt;-
tab.prior &lt;- table(df[df$days.from.opt &lt; 0, &quot;campaign.id&quot;])  # Needs spaces around &lt;-
total &lt;- sum(x[, 1])  # Needs a space after the comma
total &lt;- sum(x[, 1])  # Needs a space after the comma, not before
</code></pre>

<p>括号之前加空格, 调用函数除外</p>

<p>GOOD:</p>

<pre><code class="language-r">if (debug)
</code></pre>

<p>BAD:</p>

<pre><code class="language-r">if(debug)
</code></pre>

<p>额外的空格 比如为了使代码的等号或者(&lt;-)对齐</p>

<pre><code class="language-r">list(
  total = a + b + c, 
  mean  = (a + b + c) / n
)
</code></pre>

<p>括号和方括号的周围不要有空格
GOOD:</p>

<pre><code class="language-r">if (debug) x[1, ]
</code></pre>

<p>BAD:</p>

<pre><code class="language-r">if ( debug )  # No spaces around debug
x[1,]  # Needs a space after the comma 
</code></pre>

<h4 id="大括号">大括号</h4>

<p>左大括号不要另起一行, 右大括号一定要另起一行, 代码块包含单独语句时括号可省略, 但是代码中大括号是否省略要保持一致</p>

<pre><code class="language-r">if (is.null(ylim)) {
    ylim &lt;- c(0, 0.06)
}
## xor (but not both)

if (is.null(ylim)) ylim &lt;- c(0, 0.06)
</code></pre>

<p>代码块要另起一行</p>

<p>BAD:</p>

<pre><code class="language-r">if (is.null(ylim)) ylim &lt;- c(0, 0.06)
if (is.null(ylim)) {
    ylim &lt;- c(0, 0.06)
}
</code></pre>

<h4 id="含else代码块要使用大括号">含else代码块要使用大括号</h4>

<p><em>esle</em> 语句与大括号要在同一行</p>

<pre><code class="language-r">if (condition) {
  one or more lines
} else {
  one or more lines
}
</code></pre>

<p>BAD:</p>

<pre><code class="language-r">if (condition) {
  one or more lines
}
else {
  one or more lines
}
</code></pre>

<p>BAD:</p>

<pre><code class="language-r">if (condition)
  one line
else
  one line
</code></pre>

<p>如果条件语句后面跟着简短的语句则可以写在同行</p>

<pre><code class="language-r">if (y &lt; 0 &amp;&amp; debug) message(&quot;Y is negative&quot;)
</code></pre>

<h4 id="分号">分号</h4>

<p>行尾不要使用分号, 不要使用分号将多个语句放在同一行</p>

<h3 id="组织">组织</h3>

<h4 id="总体布局和顺序">总体布局和顺序</h4>

<ol>
<li>版权声明</li>
<li>作者</li>
<li>文件说明注释, 包括文件是用来做什么以及输入输出的说明</li>
<li><code>source()</code> 和<code>library()</code>语句</li>
<li>函数定义</li>
<li>执行语句, 也就是example (e.g., print, plot)</li>
</ol>

<p>附加单元测试文件<em>originalfilename_test.R</em></p>

<h4 id="注释">注释</h4>

<p>注释行以一个#开头, 加一个空格, 注释要说明为什么写这行代码（不是代码做了什么）</p>

<p>有时候会使用注释把代码分割成若干易读和理解的代码块，使用</p>

<pre><code class="language-r"># =================================================================
# why this code
# =================================================================
</code></pre>

<pre><code class="language-r"># Create histogram of frequency of campaigns by pct budget spent.
hist(df$pct.spent,
     breaks = &quot;scott&quot;,  # method for choosing number of buckets
     main   = &quot;Histogram: fraction budget spent by campaignid&quot;,
     xlab   = &quot;Fraction of budget spent&quot;,
     ylab   = &quot;Frequency (count of campaignids)&quot;)
</code></pre>

<h3 id="函数">函数</h3>

<p>函数的名称一般为动词；函数中的代码块应该可以在一个屏幕上阅读（二三十行）</p>

<p>####调用</p>

<p>没有缺省值的参数应该放在前面, 后面跟着有缺省值的参数</p>

<p>函数定义及调用允许一行多个参数, 换行符要在参数之间</p>

<p>GOOD</p>

<pre><code class="language-r">PredictCTR &lt;- function(query, property, num.days,
  show.plot = TRUE)
</code></pre>

<p>BAD</p>

<pre><code class="language-r">PredictCTR &lt;- function(query, property, num.days, show.plot =
  TRUE)
</code></pre>

<p>单元测试作为函数的example</p>

<h4 id="文档">文档</h4>

<p>函数应该包含注释块紧接着函数定义的行(函数体), 包含了函数的说明, 参数的使用, 返回值, 建议使用(roxygen2)[<a href="http://cran.r-project.org/web/packages/roxygen2/index.html]的模式" target="_blank">http://cran.r-project.org/web/packages/roxygen2/index.html]的模式</a>, 便于开发package,<strong>rstudio</strong>已经很好的整合了<strong>roxygen2</strong>。</p>

<h4 id="自定义函数">自定义函数</h4>

<pre><code class="language-r">CalculateSampleCovariance &lt;- function(x, y, verbose = TRUE) {
  #' @description des description Computes the sample covariance between two vectors.
  #' @author  
  #' @param x: One of twovectors whose sample covariance is to be calculated.  
  #' @param y: The other vector.
  #' @param verbose ....
  #' @details x and y must have the same length, greater than one, with no missing
  #'  values.  verbose: If TRUE, prints sample covariance; if not, not. Default
  #'  is TRUE.  Returns: The sample covariance between x and y.
  #' @return ..
  #' @examples
  #' @importFrom
  
  n &lt;- length(x)
  # Error handling
  if (n &lt;= 1 || n != length(y)) {
    stop(&quot;Arguments x and y have different lengths: &quot;, length(x), &quot; and &quot;, 
      length(y), &quot;.&quot;)
  }
  if (TRUE %in% is.na(x) || TRUE %in% is.na(y)) {
    stop(&quot; Arguments x and y must not have missing values.&quot;)
  }
  covariance &lt;- var(x, y)
  if (verbose) 
    cat(&quot;Covariance = &quot;, round(covariance, 4), &quot;.\n&quot;, sep = &quot;&quot;)
  return(covariance)
}
</code></pre>

<p><strong>此外</strong>：绝对不要使用,attch的使用会使对象中的变量加载到相应的父环境中，可能会出现同名变量对象</p>

<h3 id="ref">Ref</h3>

<ul>
<li><a href="http://stat405.had.co.nz/r-style.html" target="_blank">Hadley Wickham</a></li>
<li><a href="http://cran.r-project.org/doc/manuals/R-ints.html#R-coding-standards" target="_blank">CRAN</a></li>
<li><a href="http://cran.r-project.org/web/packages/formatR/index.html" target="_blank">formatR</a></li>
<li><a href="http://csgillespie.wordpress.com/2010/11/23/r-style-guide/" target="_blank">Colin Gillespie</a></li>
<li><a href="http://wiki.fhcrc.org/bioc/Coding_Standards" target="_blank">Bioconductor</a></li>
</ul>
    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    

    
    <li class="next"><a href="http://www.choyang.me/post/2014-11-12-r-data-structures/">R基础数据结构 <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Yang Cao &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/isotope.pkgd.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script src="/js/hugo-academic.js"></script>
    

    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

